<div class="container mt-4">
  <div class="row">
    <div class="col-12">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="display-4">Tasks</h1>
        <%= link_to 'New Task', new_task_path, class: 'btn btn-primary btn-lg' %>
      </div>

      <%# Flash messages %>
      <% if notice %>
        <div class="alert alert-success alert-dismissible fade show" role="alert">
          <%= notice %>
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      <% end %>

      <%# Stats cards %>
      <div class="row mb-4">
        <div class="col-md-3">
          <div class="card bg-light">
            <div class="card-body">
              <h5 class="card-title">Total Tasks</h5>
              <p class="card-text display-6"><%= @total_count %></p>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card border-secondary">
            <div class="card-body">
              <h5 class="card-title">Todo</h5>
              <p class="card-text display-6"><%= @todo_count %></p>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card border-warning">
            <div class="card-body">
              <h5 class="card-title">In Progress</h5>
              <p class="card-text display-6"><%= @in_progress_count %></p>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card border-success">
            <div class="card-body">
              <h5 class="card-title">Done</h5>
              <p class="card-text display-6"><%= @done_count %></p>
            </div>
          </div>
        </div>
      </div>

      <%# Filters %>
      <div class="card mb-4">
        <div class="card-body">
          <%= form_with url: tasks_path, method: :get, local: true, class: 'row g-3' do |f| %>
            <div class="col-md-4">
              <%= label_tag :status, 'Filter by Status', class: 'form-label' %>
              <%= select_tag :status, options_for_select([['All', ''], ['Todo', 'todo'], ['In Progress', 'in_progress'], ['Done', 'done']], params[:status]), class: 'form-select' %>
            </div>
            <div class="col-md-4">
              <%= label_tag :priority, 'Filter by Priority', class: 'form-label' %>
              <%= select_tag :priority, options_for_select([['All', ''], ['Low', 'low'], ['Medium', 'medium'], ['High', 'high']], params[:priority]), class: 'form-select' %>
            </div>
            <div class="col-md-4 d-flex align-items-end">
              <%= submit_tag 'Filter', class: 'btn btn-secondary me-2' %>
              <%= link_to 'Clear', tasks_path, class: 'btn btn-outline-secondary' %>
            </div>
          <% end %>
        </div>
      </div>

      <%# Tasks list %>
      <% if @tasks.any? %>
        <div class="row">
          <% @tasks.each do |task| %>
            <div class="col-md-6 mb-4">
              <div class="card h-100">
                <div class="card-body">
                  <div class="d-flex justify-content-between align-items-start mb-3">
                    <h5 class="card-title"><%= link_to task.title, task_path(task), class: 'text-decoration-none' %></h5>
                    <div class="d-flex gap-2">
                      <% case task.status %>
                      <% when 'done' %>
                        <span class="badge bg-success"><%= task.status.titleize %></span>
                      <% when 'in_progress' %>
                        <span class="badge bg-warning text-dark"><%= task.status.titleize %></span>
                      <% else %>
                        <span class="badge bg-secondary"><%= task.status.titleize %></span>
                      <% end %>

                      <% case task.priority %>
                      <% when 'high' %>
                        <span class="badge bg-danger"><%= task.priority.titleize %></span>
                      <% when 'medium' %>
                        <span class="badge bg-info text-dark"><%= task.priority.titleize %></span>
                      <% else %>
                        <span class="badge bg-light text-dark"><%= task.priority.titleize %></span>
                      <% end %>
                    </div>
                  </div>

                  <p class="card-text"><%= truncate(task.description, length: 100) %></p>

                  <div class="d-flex justify-content-between align-items-center">
                    <small class="text-muted">
                      Due: <%= task.due_date.strftime('%B %d, %Y') %>
                    </small>
                    <div class="btn-group" role="group">
                      <%= link_to 'View', task_path(task), class: 'btn btn-sm btn-outline-primary' %>
                      <%= link_to 'Edit', edit_task_path(task), class: 'btn btn-sm btn-outline-secondary' %>
                      <%= link_to 'Delete', task_path(task), method: :delete, data: { confirm: 'Are you sure?' }, class: 'btn btn-sm btn-outline-danger' %>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      <% else %>
        <div class="alert alert-info">
          <p class="mb-0">
            No tasks found. <%= link_to 'Create your first task', new_task_path, class: 'alert-link' %>
          </p>
        </div>
      <% end %>
    </div>
  </div>
</div>
